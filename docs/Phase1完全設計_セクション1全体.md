# Phase 1 完全設計 - セクション1全体（企業概要）

## 設計完了日: 2025-10-26

---

## 概要

Phase 1は、様式2「1. 企業概要」を作成するための質問フローです。
4つのサブセクションで構成され、合計32-38問の質問を通じて企業の基本情報を収集します。

---

## セクション構成と質問数

| セクション | 質問数 | 主な内容 | ドキュメント |
|----------|-------|---------|-------------|
| **1-1: 事業の概要** | 16問 | 法人/個人、業種、コンセプト、経歴、こだわり等 | [セクション1-1_事業の概要_改訂版.md](./セクション1-1_事業の概要_改訂版.md) |
| **1-2: 売上高・利益の推移** | 7-9問 | 年間売上、利益、客単価、営業日数等 | [セクション1-2_売上高利益の推移_改訂版.md](./セクション1-2_売上高利益の推移_改訂版.md) |
| **1-3: 立地と商圏** | 4-8問 | 最寄り駅、周辺環境、地域変化、競合等 | [セクション1-3_立地と商圏.md](./セクション1-3_立地と商圏.md) |
| **1-4: 業務状況と課題** | 5問 | 従業員数、業務内容、経営課題等 | [セクション1-4_業務状況と課題.md](./セクション1-4_業務状況と課題.md) |
| **合計** | **32-38問** | 条件分岐により変動 | - |

---

## 全質問リスト（ID順）

### セクション1-1: 事業の概要（16問）

1. **Q1-6**: 法人/個人事業主の区別
2. **Q1-2**: 法人名と店舗名が違うか
3. **Q1-2-company**: 法人名（条件付き）
4. **Q1-5-corporate**: 法人設立日（条件付き）
5. **Q1-5**: 店舗開業日
6. **Q1-0**: Google Maps検索
7. **Q1-0-analysis**: 自動分析（自動進行）
8. **Q1-0-website**: 追加URL入力
9. **Q1-1**: 業種確認（自動判定＋確認）
10. **Q1-3**: 商品・サービス
11. **Q1-NEW-1**: コンセプト
12. **Q1-NEW-2**: 経営者の経歴
13. **Q1-NEW-3**: こだわり
14. **Q1-NEW-4**: 顧客層
15. **Q1-NEW-5**: 利用パターン

**セクション1-1完了**: ここでは文章生成せず、セクション1-4完了後に一括生成

---

### セクション1-2: 売上高・利益の推移（7-9問）

16. **Q1-8**: 年間売上高 → 月間売上を自動計算
17. **Q1-8-trend**: 売上の傾向（上昇/横ばい/下降）
18. **Q1-9**: 経常利益 → 利益率を自動計算
19. **Q1-10**: 粗利率
20. **Q1-11**: 客単価（Q1-0-profileのestimatedPriceをデフォルト値に）
21. **Q1-NEW-6**: 客単価の内訳（条件付き: 飲食業/サービス業のみ）
22. **Q1-NEW-7**: 営業日数（Google Mapsから自動推定＋確認）
23. **Q1-NEW-8**: 粗利の理由（条件付き: 業種平均±10%以上の場合）

**セクション1-2完了**: ここでは文章生成せず、セクション1-4完了後に一括生成

---

### セクション1-3: 立地と商圏（4-8問）

24. **Q1-NEW-9**: 最寄り駅と距離（自動推定＋確認）
25. **Q1-NEW-10**: 周辺環境の特徴（複数選択）
26. **Q1-NEW-10-other**: その他の周辺環境（条件付き）
27. **Q1-NEW-11**: 地域の変化・トレンド（複数選択）
28. **Q1-NEW-11-other**: その他の地域変化（条件付き）
29. **Q1-NEW-11-detail**: 変化の詳細説明（条件付き）
30. **Q1-NEW-12**: 競合の状況
31. **Q1-NEW-12-detail**: 競合との違い（条件付き）

**セクション1-3完了**: ここでは文章生成せず、セクション1-4完了後に一括生成

---

### セクション1-4: 業務状況と課題（5問）

32. **Q1-NEW-13**: 従業員数（常時雇用）
33. **Q1-NEW-14**: 従業員数（パート・アルバイト） → 合計を自動計算
34. **Q1-NEW-15**: 主な業務内容（業種別placeholderで支援）
35. **Q1-NEW-16**: 現在の課題（Q1-7の選択を反映）
36. **Q1-NEW-17**: その他の課題（任意）

**セクション1-4完了**:
- **Q1-SECTION1-COMPLETE**: セクション1全体の完了トリガー
- **AI文章生成**: セクション1-1〜1-4の全ての回答を元に様式2「1. 企業概要」を生成
- **Q1-SECTION1-REVIEW**: 生成された文章の確認
- **Q1-SECTION1-EDIT**: 文章の編集（条件付き）
- **Phase 2へ進む**

---

## データの再利用とスマート機能

### 自動計算

| 質問ID | 計算内容 | 元データ |
|--------|---------|---------|
| Q1-8-monthly | 月間売上 | Q1-8（年間売上）÷ 12 |
| Q1-9-rate | 経常利益率 | Q1-9（経常利益）÷ Q1-8（年間売上）× 100 |
| Q1-NEW-14-total | 従業員合計 | Q1-NEW-13 + Q1-NEW-14 |

### 自動推定（デフォルト値）

| 質問ID | 推定内容 | 元データ |
|--------|---------|---------|
| Q1-1 | 業種 | Google Maps types配列から判定 |
| Q1-11 | 客単価 | Q1-0-profile.estimatedPrice |
| Q1-NEW-7 | 営業日数 | Google Maps opening_hoursから計算 |
| Q1-NEW-9 | 最寄り駅と距離 | Google Maps Places API Nearby Search |

### 条件付き質問

| 質問ID | 表示条件 |
|--------|---------|
| Q1-2-company | Q1-2 = 'はい' |
| Q1-5-corporate | Q1-6 = '法人' |
| Q1-NEW-6 | Q1-1 が飲食業またはサービス業 |
| Q1-NEW-8 | Q1-10の粗利率が業種平均±10%以上 |
| Q1-NEW-10-other | Q1-NEW-10に「その他」を含む |
| Q1-NEW-11-other | Q1-NEW-11に「その他」を含む |
| Q1-NEW-11-detail | Q1-NEW-11に「特に変化はない」以外を選択 |
| Q1-NEW-12-detail | Q1-NEW-12が「かなり多い」または「ある程度ある」 |
| Q1-SECTION1-EDIT | Q1-SECTION1-REVIEW = 'edit' |

---

## AI文章生成の仕組み

### Cloud Function: generateSection1AllDraft

**入力**: Phase 1の全ての回答（answers）

**処理**:
1. セクション1-1〜1-4の各サブセクションを個別に生成
2. 様式2のフォーマットに従って統合
3. である調（常体）で記述
4. 800-1200文字程度

**出力**:
```javascript
{
  draft: '【様式2セクション1の全文】',
  sections: {
    section1_1: '【事業の概要の文章】',
    section1_2: '【売上高・利益の推移の文章】',
    section1_3: '【立地と商圏の文章】',
    section1_4: '【業務状況と課題の文章】'
  },
  pointsUsed: 30,
  remainingPoints: 970
}
```

### 文章生成の品質基準

- **文体**: である調（常体）
- **文字数**:
  - セクション1-1: 200-400文字
  - セクション1-2: 200-300文字
  - セクション1-3: 150文字
  - セクション1-4: 200文字
  - **合計**: 800-1200文字
- **構成**: 箇条書きと段落を適切に組み合わせる
- **数値**: 具体的な数値を必ず含める
- **客観性**: 主観的すぎる表現を避ける

---

## 様式2出力イメージ

```markdown
### 1. 企業概要

#### （1）事業の概要

当店「トラットリア・ベッラ」は、2019年5月に東京都世田谷区三軒茶屋にて開業したイタリアンレストランです。本格的なイタリア料理を手頃な価格で提供することをコンセプトに、地域のお客様を中心に営業しています。

オーナーシェフである私がイタリア・トスカーナ地方で5年間修行し、現地のリストランテで料理長を務めた経験を活かし、本場の味を再現しています。食材は信頼できるイタリアの生産者から直輸入しており、他店では味わえない本格的な料理を提供している点が特徴です。

主な顧客層は30代〜50代の女性およびファミリー層で、平日はランチ利用、週末はディナー利用が中心です。

#### （2）事業別売上高・利益の推移

直近1期（2023年4月〜2024年3月）の年間売上高は1,200万円、経常利益は120万円（利益率10.0%）です。売上は前期比で微増しており、リピート顧客の増加が要因です。

客単価は約3,500円で、月間営業日数は26日、年間約312日営業しています。粗利率は60%で、イタリアンレストラン業界の平均的な水準です。

#### （3）立地と商圏

当店は三軒茶屋駅から徒歩5分の住宅街に位置しており、落ち着いた雰囲気の中で食事を楽しめる環境です。近年、駅前の再開発により若いファミリー層が増加しており、当店のターゲット顧客層と合致しています。

近隣には大手チェーン店のカジュアルイタリアンが多いものの、本格的なイタリア料理を提供する店舗は少なく、差別化できています。

#### （4）業務状況と課題

**従業員数:**
- 常時雇用従業員：2名（正社員、週30時間以上勤務）
- パート・アルバイト：3名（週30時間未満）

**主な業務:**
- 調理：私（オーナーシェフ）および調理スタッフ1名
- ホール：正社員1名、パート・アルバイト3名

**現在の課題:**
- 認知度が低く、新規顧客の獲得が課題（来客の7割が既存客）
- 公式ウェブサイトがなく、SNSのみで情報発信（予約は電話のみ対応）
- テイクアウト・デリバリーに未対応（コロナ禍で需要増加も対応できず）
- オーブンが1台のみで、ピーク時の対応に限界
```

---

## 実装の優先順位

### Phase 1（高優先度）

1. **conversationalQuestionsStep1.js の修正**
   - 新しい質問IDと質問文の追加
   - 条件分岐ロジックの実装
   - 依存関係の設定

2. **ChatContainer.jsx の修正**
   - 自動計算ロジックの追加（Q1-8-monthly、Q1-9-rate等）
   - デフォルト値の設定（Q1-11等）
   - 業種別placeholderの動的変更（Q1-NEW-15等）

3. **Cloud Functions の実装**
   - findNearestStation: 最寄り駅の検索
   - generateSection1AllDraft: セクション1全体の文章生成
   - generateSection1_1 〜 generateSection1_4: 各サブセクションの生成

4. **UI Components の実装**
   - DraftReviewComponent: 文章確認UI
   - TextareaEditComponent: 文章編集UI

### Phase 2以降（中優先度）

- Phase 2: 顧客ニーズと市場の動向（既存のAI質問生成を活用）
- Phase 3: 自社の強み（既存のAI質問生成を活用）
- Phase 4: 経営方針・目標
- Phase 5: 補助事業の内容

---

## 設計上の工夫

### 1. ユーザー負担の軽減

- **自動判定**: 業種、最寄り駅、営業日数等を自動で推定
- **デフォルト値**: Google Mapsから取得したデータを活用
- **自動計算**: 月間売上、利益率、従業員合計等を自動計算
- **業種別支援**: 業種に応じたplaceholderやヘルプテキスト

### 2. データの一貫性

- **単一データソース**: Google Maps検索（Q1-0）が全ての基盤
- **再利用**: 一度収集したデータを複数箇所で活用
- **自動検証**: 数値の整合性チェック（例: 粗利率 ≤ 100%）

### 3. 柔軟性

- **条件分岐**: 不要な質問はスキップ
- **任意質問**: 必須/任意を適切に設定
- **編集機能**: AI生成後もユーザーが自由に修正可能

### 4. 段階的な情報開示

- **質問の順序**: 答えやすい順（法人/個人 → 基本情報 → 詳細情報）
- **セクション分割**: 4つのサブセクションで情報を整理
- **最後に全体確認**: 文章化してから最終確認

---

## 今後の検討事項

### 1. 質問数の最適化

**現状**: 32-38問（条件分岐により変動）

**検討ポイント**:
- 質問数が多すぎないか？（ユーザーの離脱リスク）
- さらに統合できる質問はないか？
- 必須/任意のバランスは適切か？

### 2. AI推定の精度向上

**検討ポイント**:
- 業種判定の精度（Google Maps typesの信頼性）
- 最寄り駅推定の精度（駅の定義、バス停との区別）
- 客単価推定の精度（Google Maps価格情報の信頼性）

### 3. 文章生成の品質

**検討ポイント**:
- である調の自然さ（AIが生成する文章の品質）
- 文字数の適切さ（800-1200文字で十分か）
- 審査員の評価基準に合致するか

### 4. Phase 2以降との接続

**検討ポイント**:
- Phase 1とPhase 2のデータ連携
- 重複する質問はないか（例: 顧客層）
- 全体の所要時間（Phase 1-5まで）

---

## Phase 2への移行

### 移行タイミング

Q1-SECTION1-EDIT完了（または Q1-SECTION1-REVIEW で 'confirm' 選択）後

### 移行処理

```javascript
// ChatContainer.jsx
const moveToPhase = async (phaseNumber) => {
  setCurrentPhase(phaseNumber);

  if (phaseNumber === 2) {
    addAIMessage('✅ Phase 1が完了しました！\n\n次は、Phase 2「顧客ニーズと市場の動向」に進みます。');

    // Phase 2の最初の質問を開始
    const phase2Manager = new ConversationalPhase2Manager(
      answers['Q1-1'], // 業種
      answers
    );

    const firstQuestion = await phase2Manager.getNextQuestion();
    if (firstQuestion) {
      addAIMessage(firstQuestion.text, firstQuestion);
      setCurrentQuestion(firstQuestion);
    }
  }
};
```

### Phase 2の概要

- **AI自律質問生成**: 業種別にカスタマイズされた質問
- **一問一答形式**: 選択肢をチェックするだけ
- **優先度制御**: high/medium/lowで質問順序を最適化
- **条件付き質問スキップ**: オンライン専業、BtoB等で不要な質問をスキップ

---

## まとめ

Phase 1の設計が完了しました。

**設計の特徴:**
1. **4つのセクション**: 事業の概要、売上・利益、立地、業務・課題
2. **32-38問**: 条件分岐により最適化
3. **スマート機能**: 自動判定、自動計算、デフォルト値設定
4. **AI文章生成**: セクション1完了後に様式2形式で一括生成
5. **ユーザー編集**: 生成後も自由に修正可能

**次のステップ:**
1. **設計レビュー**: ユーザーに全体を確認してもらう
2. **実装開始**: conversationalQuestionsStep1.js 等の修正
3. **Cloud Functions実装**: generateSection1AllDraft 等の作成
4. **テスト**: 全フローの動作確認
5. **Phase 2以降の設計継続**

---

## 参考資料

- [新Phase1質問順序_申請書準拠.md](./新Phase1質問順序_申請書準拠.md) - 初期設計
- [セクション1-1_事業の概要_最終版.md](./セクション1-1_事業の概要_最終版.md) - セクション1-1初期版
- [セクション1-1_事業の概要_改訂版.md](./セクション1-1_事業の概要_改訂版.md) - セクション1-1最終版
- [セクション1-2_売上高利益の推移_改訂版.md](./セクション1-2_売上高利益の推移_改訂版.md) - セクション1-2最終版
- [セクション1-3_立地と商圏.md](./セクション1-3_立地と商圏.md) - セクション1-3設計
- [セクション1-4_業務状況と課題.md](./セクション1-4_業務状況と課題.md) - セクション1-4設計
- [様式2_サンプル_40代男性.md](./様式2_サンプル_40代男性.md) - 記載例サンプル
