# AIDANT システム仕様書 - 統合版

**作成日:** 2025-11-16
**目的:** 重要な設計仕様・実装ロジック・ガイドラインを統合管理

---

## 📋 目次

1. [決算期判定ロジック](#1-決算期判定ロジック)
2. [売上・利益推移質問設計](#2-売上利益推移質問設計)
3. [業種別回答例と創作ガイドライン](#3-業種別回答例と創作ガイドライン)
4. [質問設計改善提案（2025-11-16）](#4-質問設計改善提案2025-11-16)

---

## 1. 決算期判定ロジック

### 目的
決算月と現在日付を照合し、「直近1期」か「今期予想」かを正確に判定する。

### パターン1: 決算月を超えている場合

**例**: 決算月3月、現在2025年10月（決算月超過）

| 質問ID | 期のラベル |
|-------|----------|
| Q1-8 | **直近1期（2025年3月期）** |
| Q1-8-2期前 | **2期前（2024年3月期）** |
| Q1-8-3期前 | **3期前（2023年3月期）** |

**生成される表:**
```markdown
| 項目 | 3期前（2023年3月期） | 2期前（2024年3月期） | 直近1期（2025年3月期） |
```

### パターン2: 決算月を超えていない場合

**例**: 決算月3月、現在2025年2月（決算月前）

| 質問ID | 期のラベル |
|-------|----------|
| Q1-8 | **今期予想（2025年3月期）** ← まだ決算していない |
| Q1-8-2期前 | **1期前（2024年3月期）** |
| Q1-8-3期前 | **2期前（2023年3月期）** |

**生成される表:**
```markdown
| 項目 | 2期前（2023年3月期） | 1期前（2024年3月期） | 今期予想（2025年3月期） |
```

### 実装: fiscalYearHelper.js

**場所:** `src/services/ai/fiscalYearHelper.js`

#### isPastFiscalMonth(fiscalMonth, currentDate)

決算月を超えているか判定。

```javascript
export function isPastFiscalMonth(fiscalMonth, currentDate = new Date()) {
  const currentMonth = currentDate.getMonth() + 1; // 0-11 → 1-12
  return currentMonth > fiscalMonth;
}

// 例:
// 決算月3月、現在10月 → 10 > 3 → true（超過）
// 決算月3月、現在2月 → 2 > 3 → false（未超過）
```

#### getCurrentFiscalYear(fiscalMonth, currentDate)

決算年度を計算。

```javascript
export function getCurrentFiscalYear(fiscalMonth, currentDate = new Date()) {
  const currentYear = currentDate.getFullYear();
  const currentMonth = currentDate.getMonth() + 1;

  if (currentMonth > fiscalMonth) {
    return currentYear; // 決算月超過 → 現在年が決算年
  } else {
    return currentYear - 1; // 決算月前 → 前年が決算年
  }
}

// 例:
// 決算月3月、現在2025年10月 → 2025（2025年3月期は終了）
// 決算月3月、現在2025年2月 → 2024（2025年3月期はまだ）
```

#### getFiscalPeriodLabel(fiscalMonth, yearsAgo, currentDate)

期のラベルを生成。

```javascript
export function getFiscalPeriodLabel(fiscalMonth, yearsAgo, currentDate = new Date()) {
  const isPast = isPastFiscalMonth(fiscalMonth, currentDate);
  const currentFiscalYear = getCurrentFiscalYear(fiscalMonth, currentDate);

  const fiscalYear = currentFiscalYear - yearsAgo;

  let label;
  if (yearsAgo === 0) {
    label = isPast ? `直近1期（${fiscalYear}年${fiscalMonth}月期）`
                    : `今期予想（${fiscalYear + 1}年${fiscalMonth}月期）`;
  } else {
    const periodLabel = isPast ? `${yearsAgo + 1}期前` : `${yearsAgo}期前`;
    label = `${periodLabel}（${fiscalYear}年${fiscalMonth}月期）`;
  }

  return {
    label,
    fiscalYear,
    isForecast: !isPast && yearsAgo === 0
  };
}

// 例:
// 決算月3月、現在2025年10月、yearsAgo=0
// → { label: '直近1期（2025年3月期）', isForecast: false }

// 決算月3月、現在2025年2月、yearsAgo=0
// → { label: '今期予想（2025年3月期）', isForecast: true }
```

#### getTableLabels(fiscalMonth, has2PeriodsAgo, has3PeriodsAgo, currentDate)

テーブル用のラベルを一括生成。

```javascript
export function getTableLabels(fiscalMonth, has2PeriodsAgo, has3PeriodsAgo, currentDate = new Date()) {
  const current = getFiscalPeriodLabel(fiscalMonth, 0, currentDate);
  const prev1 = has2PeriodsAgo ? getFiscalPeriodLabel(fiscalMonth, 1, currentDate) : null;
  const prev2 = has3PeriodsAgo ? getFiscalPeriodLabel(fiscalMonth, 2, currentDate) : null;

  return { current, prev1, prev2 };
}
```

#### getFiscalMonthExplanation(fiscalMonth, currentDate)

決算月超過の説明文を生成。

```javascript
export function getFiscalMonthExplanation(fiscalMonth, currentDate = new Date()) {
  const isPast = isPastFiscalMonth(fiscalMonth, currentDate);

  if (isPast) {
    return `決算月（${fiscalMonth}月）は既に過ぎているため、直近の決算期の実績値を入力してください。`;
  } else {
    return `決算月（${fiscalMonth}月）がまだ到来していないため、今期の予想値を入力してください。`;
  }
}
```

### 完了済み決算期数の自動判定

**重要な発見（2025-11-16）:** 創業日と決算月から、完了済み決算期数を自動計算する必要がある。

#### calculateCompletedFiscalYears()

```javascript
/**
 * 完了済み決算期数を自動判定
 * @param {number} foundingYear - 創業年
 * @param {number} foundingMonth - 創業月
 * @param {number} fiscalYearEndMonth - 決算月
 * @param {Date} today - 今日の日付
 * @returns {number} 完了済み期数
 */
function calculateCompletedFiscalYears(foundingYear, foundingMonth, fiscalYearEndMonth, today) {
  const foundingDate = new Date(foundingYear, foundingMonth - 1, 1);

  // 第1期の終了日
  let firstFiscalYearEnd;
  if (fiscalYearEndMonth >= foundingMonth) {
    // 同年内に決算
    firstFiscalYearEnd = new Date(foundingYear, fiscalYearEndMonth, 0); // 月末
  } else {
    // 翌年に決算
    firstFiscalYearEnd = new Date(foundingYear + 1, fiscalYearEndMonth, 0);
  }

  // 第1期終了から何年経過したか
  const yearsSinceFirstFiscalEnd = today.getFullYear() - firstFiscalYearEnd.getFullYear();

  // 今年の決算月は過ぎたか
  const currentYearFiscalEnd = new Date(today.getFullYear(), fiscalYearEndMonth, 0);
  const hasCurrentYearFiscalEnded = today > currentYearFiscalEnd;

  // 完了済み期数
  let completedYears = 1 + yearsSinceFirstFiscalEnd;
  if (!hasCurrentYearFiscalEnded && yearsSinceFirstFiscalEnd > 0) {
    completedYears--;
  }

  // 決算書完成まで2ヶ月必要
  const latestCompletedFiscalEnd = new Date(
    today.getFullYear() - (hasCurrentYearFiscalEnded ? 0 : 1),
    fiscalYearEndMonth,
    0
  );
  const twoMonthsLater = new Date(latestCompletedFiscalEnd);
  twoMonthsLater.setMonth(twoMonthsLater.getMonth() + 2);

  if (today < twoMonthsLater) {
    completedYears--;
  }

  return Math.max(0, completedYears);
}
```

**実例: 合同会社NEKI**

```javascript
// 合同会社NEKI
const completedYears = calculateCompletedFiscalYears(
  2023,  // 創業年
  8,     // 創業月（8月）
  7,     // 決算月（7月）
  new Date(2025, 10, 16) // 2025年11月16日
);

console.log(completedYears); // 2

// 内訳:
// 第1期: 2023年8月～2024年7月（決算書: 2024年9月完成）
// 第2期: 2024年8月～2025年7月（決算書: 2025年9月完成）
// 第3期: 2025年8月～2026年7月（進行中）
```

---

## 2. 売上・利益推移質問設計

### 目的
様式2「（2）事業別売上高・利益の推移」を作成するためのデータ収集。

### 様式2の記載要件

**表のフォーマット（記載例より）:**

| 項目 | 3期前（2022年3月期） | 2期前（2023年3月期） | 直近1期（2024年3月期） |
|-----|---------------------|---------------------|---------------------|
| **事業別売上高** | | | |
| 店舗事業 | 22,310,000円 | 28,090,000円 | 30,070,000円 |
| オンライン事業 | 1,220,000円 | 1,350,000円 | 1,490,000円 |
| **合計** | **23,530,000円** | **29,440,000円** | **31,560,000円** |
| **事業別経常利益** | | | |
| 店舗事業 | 980,000円 | 1,210,000円 | 1,670,000円 |
| オンライン事業 | 110,000円 | 230,000円 | 250,000円 |
| **合計** | **1,090,000円** | **1,440,000円** | **1,920,000円** |

**注意:**
- 開業年数により1〜3期分を柔軟に対応

### 質問フロー

#### ステップ1: 直近1期（必須）

**Q1-8: 直近1年間の年間売上**
- タイプ: number
- 単位: 万円
- 必須: はい

**Q1-9: 直近1年間の経常利益**
- タイプ: number
- 単位: 万円
- 必須: はい

**補足情報:**
- Q1-5-fiscal（決算月）を使って「直近1期（20XX年X月期）」と表示

#### ステップ2: 2期前の確認（条件付き）

**Q1-8-history-available: 2期前のデータ**
- タイプ: single_select
- 選択肢: 「はい」「いいえ」
- 必須: はい
- 条件: 開業から2年以上経過している場合のみ表示

**条件判定ロジック:**
```javascript
condition: (answers) => {
  const openingDate = new Date(answers['Q1-5']);
  const fiscalMonth = parseInt(answers['Q1-5-fiscal']);
  const today = new Date();

  // 開業日から何期経過しているか計算
  const completedYears = calculateCompletedFiscalYears(
    openingDate.getFullYear(),
    openingDate.getMonth() + 1,
    fiscalMonth,
    today
  );

  // 2年以上経過していればtrue
  return completedYears >= 2;
}
```

#### ステップ3: 2期前のデータ入力（条件付き）

**Q1-8-2期前: 2期前の年間売上**
- タイプ: number
- 単位: 万円
- 必須: はい
- 条件: Q1-8-history-available === 'はい'

**Q1-9-2期前: 2期前の経常利益**
- タイプ: number
- 単位: 万円
- 必須: はい
- 条件: Q1-8-history-available === 'はい'

#### ステップ4: 3期前の確認（条件付き）

**Q1-8-3期前-available: 3期前のデータ**
- タイプ: single_select
- 選択肢: 「はい」「いいえ」
- 必須: はい
- 条件: 開業から3年以上経過している場合のみ表示

```javascript
condition: (answers) => {
  const openingDate = new Date(answers['Q1-5']);
  const fiscalMonth = parseInt(answers['Q1-5-fiscal']);
  const today = new Date();

  const completedYears = calculateCompletedFiscalYears(
    openingDate.getFullYear(),
    openingDate.getMonth() + 1,
    fiscalMonth,
    today
  );

  // 3年以上経過 かつ 2期前のデータが「はい」
  return completedYears >= 3 && answers['Q1-8-history-available'] === 'はい';
}
```

#### ステップ5: 3期前のデータ入力（条件付き）

**Q1-8-3期前: 3期前の年間売上**
**Q1-9-3期前: 3期前の経常利益**

### 補足質問（様式2の補完）

#### Q1-10: 月間平均売上

```javascript
{
  id: 'Q1-10',
  priority: 9.8,
  text: '月間の平均売上はいくらですか？（概算で構いません）',
  type: 'number',
  placeholder: '例：250（万円）',
  required: false,
  dependencies: ['Q1-8'],
  aiEnhance: false,
  helpText: '💡 年間売上÷12でおおよその金額を入力してください',
  validation: (value, answers) => {
    const annualRevenue = answers['Q1-8'];
    const monthlyAverage = annualRevenue / 12;

    if (value > monthlyAverage * 1.5 || value < monthlyAverage * 0.5) {
      return {
        isValid: false,
        message: `⚠️ 年間売上${annualRevenue}万円の場合、月間平均は約${Math.round(monthlyAverage)}万円です。\n\n入力値が大きく異なりますが、季節変動が大きい場合はそのまま進めてください。`
      };
    }

    return { isValid: true };
  }
}
```

#### Q1-11: 客単価

**目的:** 補助事業効果の試算（新規顧客数 × 客単価）

#### Q1-12: 営業日数

**目的:** 日次売上の計算、補助事業効果の日次シミュレーション

#### Q1-13: 売上総利益率（粗利率）

**目的:** 経営分析の精度向上、補助事業効果のシミュレーション

```javascript
{
  id: 'Q1-13',
  priority: 10.1,
  text: '売上総利益率（粗利率）はわかりますか？',
  type: 'number',
  placeholder: '例：60（%）',
  required: false,
  helpText: '💡 売上総利益率（粗利率）= （売上高 - 売上原価）÷ 売上高 × 100\n\n【目安】\n- 飲食業: 60-70%\n- 小売業: 30-40%\n- サービス業: 50-60%\n\nわからない場合は空欄のままで構いません。'
}
```

### 優先度（priority）の配置

| 質問ID | priority | 説明 |
|-------|---------|------|
| Q1-8 | 9.0 | 直近1期の年間売上（必須） |
| Q1-9 | 9.1 | 直近1期の経常利益（必須） |
| Q1-8-history-available | 9.2 | 2期前データの有無確認 |
| Q1-8-2期前 | 9.3 | 2期前の年間売上 |
| Q1-9-2期前 | 9.4 | 2期前の経常利益 |
| Q1-8-3期前-available | 9.5 | 3期前データの有無確認 |
| Q1-8-3期前 | 9.6 | 3期前の年間売上 |
| Q1-9-3期前 | 9.7 | 3期前の経常利益 |
| Q1-10 | 9.8 | 月間平均売上（任意） |
| Q1-11 | 9.9 | 客単価（任意） |
| Q1-12 | 10.0 | 営業日数（任意） |
| Q1-13 | 10.1 | 売上総利益率（任意） |

### テストケース

#### ケース1: 開業1年目（2期前・3期前なし）

**入力:**
- Q1-5: 2024-04-01
- Q1-5-fiscal: 3
- Q1-8: 600
- Q1-9: 10

**期待される質問:**
- Q1-8-history-available: 表示されない（1年未満）

**生成される表:**
```markdown
| 項目 | 直近1期（2025年3月期） |
|-----|---------------------|
| **年間売上** | 600万円 |
| **経常利益** | 10万円 |
```

#### ケース2: 開業2年目（2期前あり、3期前なし）

**入力:**
- Q1-5: 2023-04-01
- Q1-5-fiscal: 3
- Q1-8: 600
- Q1-9: 10
- Q1-8-history-available: はい
- Q1-8-2期前: 450
- Q1-9-2期前: -20

**生成される表:**
```markdown
| 項目 | 2期前（2024年3月期） | 直近1期（2025年3月期） |
|-----|---------------------|---------------------|
| **年間売上** | 450万円 | 600万円 |
| **経常利益** | -20万円 | 10万円 |
```

#### ケース3: 開業3年以上（3期分すべて）

**入力:**
- Q1-5: 2020-04-01
- Q1-5-fiscal: 3
- Q1-8: 3156
- Q1-9: 192
- Q1-8-history-available: はい
- Q1-8-2期前: 2944
- Q1-9-2期前: 144
- Q1-8-3期前-available: はい
- Q1-8-3期前: 2353
- Q1-9-3期前: 109

**生成される表:**
```markdown
| 項目 | 3期前（2022年3月期） | 2期前（2023年3月期） | 直近1期（2024年3月期） |
|-----|---------------------|---------------------|---------------------|
| **年間売上** | 2353万円 | 2944万円 | 3156万円 |
| **経常利益** | 109万円 | 144万円 | 192万円 |
```

---

## 3. 業種別回答例と創作ガイドライン

### 創作の原則

#### ✅ 創作して良い項目（判別・証明が困難）

1. **顧客の声・評価**
   - 「お客様から〜と言われます」
   - **理由:** 口頭のフィードバックは証明不可能

2. **経営の想い・ビジョン**
   - 「〜という想いで開業しました」
   - **理由:** 主観的な内容、内心の証明は不可能

3. **業務の工夫・こだわり**
   - 「毎朝〜を行っています」
   - **理由:** 日常業務の詳細は外部から確認不可能

4. **顧客層の詳細な内訳**
   - 「30代女性が6割、40代が3割」
   - **理由:** 詳細な顧客データは公開義務なし

5. **将来の計画・見込み**
   - 「〜の効果で売上が○○万円増加する見込み」
   - **理由:** 未来の予測、証明不可能

6. **リピーター率、顧客満足度**
   - 「リピーター率70%」
   - **理由:** 内部データ、公開義務なし

#### ❌ 創作してはいけない項目（証明可能・虚偽になる）

1. **売上・利益の数値**
   - 決算書・確定申告書で確認可能
   - **対応:** ユーザーの入力値をそのまま使用

2. **開業年、決算月**
   - 登記簿、開業届で確認可能
   - **対応:** ユーザーの入力値をそのまま使用

3. **従業員数**
   - 社会保険記録で確認可能
   - **対応:** ユーザーの入力値をそのまま使用

4. **資格・免許**
   - 証明書の提出を求められる可能性
   - **対応:** ユーザーの入力値をそのまま使用

5. **Google Maps評価**
   - 公開データで確認可能
   - **対応:** 実際のデータを使用（API取得）

6. **所在地、店舗名**
   - 登記簿、Google Mapsで確認可能
   - **対応:** ユーザーの入力値をそのまま使用

#### ⚠️ 控えめに創作する項目（現実的な範囲で）

1. **仕入先、取引先**
   - 「〇〇県の農家から直接仕入れ」
   - **理由:** 確認は困難だが、具体的すぎると嘘がバレる
   - **対応:** 一般的な表現に留める

2. **過去の経歴**
   - 「前職で〇〇業界に10年勤務」
   - **理由:** 職歴詐称になる可能性
   - **対応:** ユーザーが入力した場合のみ使用

3. **受賞歴、メディア掲載**
   - 「〇〇雑誌に掲載」
   - **理由:** 確認可能
   - **対応:** ユーザーが入力した場合のみ使用

### 業種別の基本データ

#### 🍝 飲食業（レストラン・カフェ）

**売上・利益の目安:**
- 小規模カフェ：月間売上60-100万円、年間720-1,200万円
- レストラン：月間売上100-200万円、年間1,200-2,400万円
- 利益率：8-15%（飲食業の平均10%）
- 粗利率：60-70%（原価率30-40%）

**客単価:**
- カフェ：1,000-2,000円
- ランチ：1,000-1,500円
- ディナー：3,000-8,000円

**顧客層:**
- カフェ：20-40代女性が中心
- レストラン：30-50代、ファミリー層、カップル
- ランチ：近隣の会社員、主婦
- ディナー：デート、家族

**強み（創作例）:**
- 「シェフが〇〇で修行した経験を活かし〜」
- 「地元の農家から直接仕入れた新鮮な野菜を使用」
- 「自家製パン、自家焙煎コーヒー」
- 「季節の食材を使ったメニュー」

**課題（創作例）:**
- 「認知度が低く、新規客の獲得が課題」
- 「雨の日の来客数減少」
- 「ピーク時の対応に限界」
- 「テイクアウト・デリバリー未対応」

#### 💇 美容室・理容室

**売上・利益の目安:**
- 小規模美容室：月間売上100-200万円、年間1,200-2,400万円
- 利益率：10-20%
- 粗利率：70-80%（技術サービスのため高い）

**客単価:**
- カット：3,000-5,000円
- カット+カラー：8,000-12,000円
- パーマ込み：10,000-15,000円

**顧客層:**
- 女性美容室：20-50代女性
- メンズ特化：20-40代男性
- ファミリー向け：幅広い年齢層

**強み（創作例）:**
- 「美容師歴〇〇年のベテランスタイリスト」
- 「〇〇コンテスト入賞経験あり」
- 「髪質診断を行い、一人ひとりに合った施術」
- 「オーガニック薬剤を使用」

**課題（創作例）:**
- 「予約管理が電話のみで効率が悪い」
- 「新規客の獲得が課題」
- 「リピーター率の向上」

#### 🛍️ 小売業（雑貨・アパレル・食品販売）

**売上・利益の目安:**
- 小規模店舗：月間売上80-150万円、年間960-1,800万円
- 利益率：5-10%（仕入販売のため低め）
- 粗利率：30-50%（原価率50-70%）

**客単価:**
- 雑貨：2,000-5,000円
- アパレル：5,000-15,000円
- 食品：1,000-3,000円

**顧客層:**
- 雑貨：20-40代女性
- アパレル：ターゲット年齢層による
- 食品：地域住民、幅広い年齢層

**強み（創作例）:**
- 「作家と直接取引し、他店にない商品を扱う」
- 「セレクトショップとして厳選した商品のみ」
- 「接客を重視し、お客様一人ひとりに丁寧に対応」

**課題（創作例）:**
- 「Eコマースとの価格競争」
- 「在庫管理の効率化」
- 「認知度向上」

---

## 4. 質問設計改善提案（2025-11-16）

### 問題の本質

#### ❌ 現状の問題

1. **Phase 1-6の質問が「事実確認」に偏りすぎている**
   - Q1-8: 「年間売上は？」→ 「639万円」
   - **不足**: 月次推移、時間帯別売上、顧客数、客単価、成約率

2. **Phase 2-5の質問が「主観的な意見」を聞くだけ**
   - P2-1: 「ターゲット顧客は？」→ 「宿泊業、飲食業」
   - **不足**: 実際の顧客の声、導入実績、Google Maps評価

3. **AIが様式2作成時に「データ不足」に気づく**
   - 表を作ろうとしても、**データがない**
   - 出典を書こうとしても、**ユーザーが調べていない**
   - 口コミを引用しようとしても、**収集していない**

### ✅ 解決策: 「様式2の完成形から逆算した質問設計」

#### 新しい質問フロー設計の原則

1. **AIが最終的に必要とするデータを先に特定**
2. **そのデータを収集するための質問を設計**
3. **ユーザーには「なぜこの情報が必要か」を説明**

### 具体的な質問改善例

#### Phase 1: 基本情報の改善

**❌ 現在の質問:**
```
Q1-8: 直近期の年間売上を教えてください
→ 回答: 6,392,731円
```

**✅ 改善後の質問（様式2から逆算）:**

```
Q1-8-1: 直近期の年間売上を教えてください
→ 回答: 6,392,731円

Q1-8-2: 月次売上の推移データはありますか？
【なぜ必要?】様式2では「売上の季節変動」を表で示すと説得力が増します

選択肢:
1. はい、月次データがあります
2. いいえ、年間のみです

↓「2」を選択

Q1-8-3: では、売上のピーク時期と閑散期を教えてください
【AIが補完】月次データがない場合、AIが推定値で表を作成します
```

#### Phase 1-B: 顧客データの追加（新規質問）

```
Q1-11: 月間の問い合わせ件数・成約件数を教えてください

【なぜ必要?】様式2「補助事業の効果」セクションで、
「現状: 月間5件 → 補助事業後: 月間15件」のような数値目標を示すと
審査員に説得力があります。

月間問い合わせ数: ______件
成約率: ______%
月間成約件数: ______件
```

#### Phase 2: 顧客ニーズの改善

**❌ 現在の質問:**
```
P2-1: ターゲット顧客は誰ですか？
→ 回答: 宿泊業、飲食業、美容院
```

**✅ 改善後の質問（様式2から逆算）:**

```
P2-1: ターゲット顧客は誰ですか？
→ 回答: 宿泊業、飲食業、美容院

P2-1-A: これまでに導入した顧客はいますか？

選択肢:
1. はい、導入実績があります
2. いいえ、これから獲得します

↓「1」を選択

P2-1-B: 導入実績の詳細を教えてください

【なぜ必要?】様式2「自社の強み」セクションで、
「宿泊業3件、飲食業2件、美容院1件の導入実績」のように
具体的な数字を示すと信頼性が高まります。

宿泊業: ___件
飲食業: ___件
美容院: ___件
```

```
P2-2: 顧客からの評価・口コミはありますか？

【なぜ必要?】様式2では「Google Maps口コミ」や
「顧客アンケート」を引用すると、強みの裏付けになります。

選択肢:
1. Google Maps評価があります
2. 顧客からの声があります（メール・アンケート等）
3. まだありません

↓「1」または「2」を選択

P2-2-A: では、特に印象的だった顧客の声を教えてください

例: 「無人チェックインにより、フロント業務が50%削減された」

顧客の声（1-2個）:
1. _________________________________
2. _________________________________
```

#### Phase 2-C: 市場データの収集支援（新規質問）

```
P2-5: 業界の市場動向について調べたデータはありますか？

【なぜ必要?】様式2「顧客ニーズと市場の動向」セクションでは、
「○○省の調査（2024年）によると…」のように
出典付きのデータを記載すると説得力が増します。

選択肢:
1. はい、調査データがあります
2. いいえ、ありません

↓「2」を選択（AIが支援）

【AIからの提案】
業種「IoT/PMS開発」に関連する市場データを探しますか？

選択肢:
1. はい、探してください
2. いいえ、このまま進めます

↓「1」を選択

【AIがWeb検索】
「経済産業省 中小企業デジタル化実態調査 2024」を見つけました。
以下の内容を様式2に引用しますか？

「宿泊業・飲食業の78%が『予約管理・在庫管理の自動化』を課題として挙げている」
出典: 経済産業省「中小企業デジタル化実態調査」2024年

選択肢:
1. はい、引用してください
2. いいえ、別のデータを探します
```

#### Phase 4: 経営方針の改善

**❌ 現在の質問:**
```
P4-3: 売上目標を教えてください
→ 回答: 2000万円
```

**✅ 改善後の質問（様式2から逆算）:**

```
P4-3: 次期（2026年7月期）の売上目標を教えてください
→ 回答: 2000万円

【AIが自動計算】
現状639万円 → 目標2000万円 = 約3.1倍の成長
かなり高い目標ですが、達成の根拠を示す必要があります。

P4-3-A: この売上目標の根拠を教えてください

【なぜ必要?】様式2では「売上増加の根拠」を
具体的な数値で示す必要があります。

例:
- 新規顧客数: 月間5件 → 15件（3倍）
- 成約率: 30% → 50%（向上）
- 平均単価: 70万円（維持）
→ 15件 × 50% × 70万円 × 12ヶ月 = 6,300万円（理論値）
→ 保守的見積もり30% = 1,890万円 ≒ 2000万円

質問: 売上増加の要因を選んでください（複数選択可）

1. 新規顧客数の増加（月間〇件 → 〇件）
2. 成約率の向上（〇% → 〇%）
3. 平均単価の向上（〇円 → 〇円）
4. リピート率の向上
5. その他
```

#### Phase 5: 補助事業の効果の改善

**❌ 現在の質問:**
```
P5-4: 新規顧客数はどのくらい増加する見込みですか？
→ 回答: わかりません（スキップ）
```

**✅ 改善後の質問（様式2から逆算）:**

```
P5-4: 新規顧客数はどのくらい増加する見込みですか？

【なぜ必要?】様式2「補助事業の効果」セクションでは、
具体的な数値目標を示す必要があります。

カフェサンプルの記載例:
「月間売上30%増（90万→120万）、年間360万円増」

あなたの場合の試算をお手伝いします。

━━━━━━━━━━━━━━━━━━━━
【AIによる自動試算】
━━━━━━━━━━━━━━━━━━━━

補助事業の内容:
- UVプリンター導入 → デモ製品の訴求力向上
- パンフレット制作 → 展示会・営業先での配布
- 動画広告制作 → YouTube・SNS広告配信
- HPリニューアル → 問い合わせフォーム改善

これらの施策により、以下の効果が見込まれます:

1. Web問い合わせ増加
   現状: 月間5件
   ↓
   HPリニューアル + 動画広告 → 月間15件（3倍）

2. 成約率向上
   現状: 30%
   ↓
   パンフレット + デモ製品 → 50%（1.7倍）

3. 月間成約件数
   15件 × 50% = 7.5件（現状1.5件の5倍）

4. 年間売上
   7.5件 × 70万円 × 12ヶ月 = 6,300万円（理論値）
   保守的見積もり30% = 1,890万円

【この試算を様式2に記載しますか?】

選択肢:
1. はい、この試算を使ってください
2. いいえ、数値を修正します
```

### 新しい質問フローの全体像

#### Phase 1: 基本情報（拡張版）

| 質問ID | 質問内容 | 目的（様式2のどこで使う） |
|--------|---------|----------------------|
| Q1-8-1 | 年間売上 | 企業概要の表 |
| **Q1-8-2** | 月次売上推移 | 企業概要の表（季節変動） |
| **Q1-11** | 月間問い合わせ数・成約率 | 補助事業の効果試算 |
| **Q1-12** | 平均受注単価 | 補助事業の効果試算 |
| **Q1-13** | 顧客別受注実績 | 自社の強み（実績） |

#### Phase 2: 顧客ニーズ（拡張版）

| 質問ID | 質問内容 | 目的（様式2のどこで使う） |
|--------|---------|----------------------|
| P2-1 | ターゲット顧客 | 顧客ニーズと市場の動向 |
| **P2-1-A** | 導入実績の有無 | 自社の強み |
| **P2-1-B** | 導入実績の詳細（件数） | 自社の強み（表） |
| **P2-2** | 顧客の声・口コミ | 自社の強み（引用） |
| **P2-5** | 市場データの有無 | 顧客ニーズと市場の動向（出典） |
| **P2-5-A** | AIによるデータ検索支援 | 顧客ニーズと市場の動向（出典） |

#### Phase 4: 経営方針（拡張版）

| 質問ID | 質問内容 | 目的（様式2のどこで使う） |
|--------|---------|----------------------|
| P4-3 | 売上目標 | 経営方針・目標 |
| **P4-3-A** | 売上増加の根拠 | 経営方針・目標（試算） |
| **P4-3-B** | 新規顧客数の見込み | 補助事業の効果 |
| **P4-4** | 5年後の目標 | 経営方針・目標（5年計画） |

#### Phase 5: 補助事業の効果（拡張版）

| 質問ID | 質問内容 | 目的（様式2のどこで使う） |
|--------|---------|----------------------|
| P5-4 | 新規顧客増加見込み | 補助事業の効果 |
| **P5-4-A** | AIによる効果試算 | 補助事業の効果（表） |
| **P5-5** | 投資回収期間の試算 | 補助事業の効果 |

### 実装すべき新機能

#### 1. AIによる自動試算機能

```javascript
// Phase 4-3-Aで売上目標の根拠を自動計算
const calculateSalesTarget = (currentData, targetSales) => {
  const current = {
    monthlyInquiries: 5,
    conversionRate: 0.3,
    avgOrderValue: 700000,
    annualSales: 6392731
  };

  const requiredMonthlyInquiries = targetSales / 12 / avgOrderValue / conversionRate;

  return {
    message: `目標${targetSales}円を達成するには、月間問い合わせを${requiredMonthlyInquiries}件に増やす必要があります`,
    realistic: requiredMonthlyInquiries < current.monthlyInquiries * 5 // 5倍以内なら現実的
  };
};
```

#### 2. Web検索による市場データ収集支援

```javascript
// Phase 2-5-Aで市場データを検索
const searchMarketData = async (businessType) => {
  const query = `${businessType} 市場動向 調査 2024`;
  const results = await webSearch(query);

  return {
    source: results[0].source,
    summary: results[0].content,
    citation: `${results[0].source}, 2024`
  };
};
```

#### 3. Google Maps口コミ収集支援

```javascript
// Phase 2-2で口コミを収集
const fetchGoogleReviews = async (placeId) => {
  const reviews = await googleMapsAPI.getReviews(placeId);

  return reviews
    .filter(r => r.rating >= 4)
    .slice(0, 3)
    .map(r => ({
      text: r.text,
      rating: r.rating
    }));
};
```

### 実装優先度

#### 最優先（今すぐ実装すべき）

1. ✅ `calculateCompletedFiscalYears()` 関数の実装
2. ✅ Q1-5の直後に「決算期判定」を自動実行
3. ✅ 期数に応じてQ1-8-historyの質問を動的に変更
4. ✅ 様式2生成時に推移表を自動作成

#### 高優先（Phase 1-6の全面的な見直し）

1. ✅ Phase 1に「月間問い合わせ数・成約率」を追加
2. ✅ Phase 2に「導入実績・口コミ収集」を追加
3. ✅ Phase 2に「市場データ検索支援」を追加
4. ✅ Phase 4に「売上目標の根拠試算」を追加
5. ✅ Phase 5に「補助事業効果の自動試算」を追加

#### 中優先（AI支援機能）

1. ✅ Web検索による市場データ収集
2. ✅ Google Maps口コミ自動取得
3. ✅ 売上目標達成の自動試算
4. ✅ 補助事業効果の自動試算

### 期待される効果

この改善により、様式2のクオリティは以下のように向上する:

| 項目 | 改善前 | 改善後 |
|------|--------|--------|
| 完成度 | 60% | **90%以上** |
| 数値データの充実度 | 20% | **90%以上** |
| 出典・根拠の明示 | 0% | **80%以上** |
| 顧客評価の引用 | 0% | **80%以上** |
| 採択可能性 | 低 | **高** |

---

## まとめ

このドキュメントは以下の4つの重要仕様を統合しています:

1. **決算期判定ロジック** - 決算月と現在日付から正確な期を判定
2. **売上・利益推移質問設計** - 1〜3期分のデータを柔軟に収集
3. **業種別回答例と創作ガイドライン** - 何を創作して良いか/悪いかの明確な基準
4. **質問設計改善提案（2025-11-16）** - 様式2から逆算した新しい質問設計

これらの仕様は相互に関連しており、高品質な様式2を生成するために不可欠です。

**次のステップ:** この統合仕様書を基に、古い設計ドキュメント31ファイルを削除し、docs フォルダを整理します。
