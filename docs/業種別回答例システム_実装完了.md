# 業種別回答例システム実装完了レポート

## 実装日時
2025年10月23日

## 実装内容

ユーザーの業種に応じて適切な回答例を動的に表示するシステムを実装しました。

---

## 1. 実装したファイル

### 1.1 新規作成ファイル

#### `src/services/ai/industryExamples.js`
業種別の回答例とヒントを提供する中核モジュール

**主な機能:**
- 業種の自動判定（Q1-1の回答から）
- 業種別のベンチマークデータ提供
- 業種別の回答例データベース
- 動的なplaceholder生成
- 動的なhelpText生成

**対応業種:**
1. レストラン
2. カフェ
3. 美容業
4. 小売業
5. 宿泊業
6. サービス業
7. その他

**提供データ:**
- 年間売上目安（最小・最大・平均）
- 利益率（最小・最大・平均）
- 粗利率（最小・最大・平均）
- 客単価（最小・最大・平均）
- Phase 2（顧客分析）の業種別回答例
- Phase 3（強み分析）の業種別回答例

---

### 1.2 更新したファイル

#### `src/services/ai/conversationalQuestionsPhase2.js`
Phase 2の6つの質問すべてに業種別の動的例文を適用

**変更内容:**
- `getDynamicPlaceholder`関数をimport
- `getDynamicHelpText`関数をimport
- P2-1からP2-6までの全質問のplaceholderを関数形式に変更
- 業種に応じた例文が自動表示される仕組みを実装

#### `src/services/ai/conversationalQuestionsPhase3.js`
Phase 3の7つの質問すべてに業種別の動的例文を適用

**変更内容:**
- `getDynamicPlaceholder`関数をimport
- `getDynamicHelpText`関数をimport
- P3-1からP3-7までの全質問のplaceholderを関数形式に変更
- 強みの例文が業種に応じて自動的に変わる仕組みを実装

#### `src/services/ai/conversationalQuestionsStep1.js`
財務データ質問（Q1-20、Q1-21）に業種別ヘルプテキストを適用

**変更内容:**
- `getDynamicHelpText`関数をimport
- Q1-20（粗利率）のhelpTextを`industryExamples.js`の関数に置き換え
- Q1-21（客単価）のhelpTextを`industryExamples.js`の関数に置き換え

---

## 2. 動作の仕組み

### フロー図

```
[ユーザー入力]
     ↓
Q1-1: 業種を入力（例：「イタリアンレストラン」）
     ↓
answers['Q1-1'] に保存
     ↓
Phase 2の質問表示時
     ↓
getDynamicPlaceholder('P2-1', answers) が呼ばれる
     ↓
detectIndustry('イタリアンレストラン') → 'restaurant'
     ↓
PHASE2_EXAMPLES['restaurant']['targetCustomer'] を取得
     ↓
「例：30-50代の女性グループ、デート利用のカップル」と表示
```

### 具体例

**イタリアンレストランの場合:**

- Q1-1: 「イタリアンレストラン」と入力
- P2-1（ターゲット顧客）の例文: 「30-50代の女性グループ、デート利用のカップル」
- P3-1（強み）の例文: 「現地イタリアで修行したシェフの本格的な味、地元食材を活用した季節メニュー」
- Q1-20（粗利率）のヘルプ: 「レストランの平均：約65%」

**カフェの場合:**

- Q1-1: 「カフェ」と入力
- P2-1（ターゲット顧客）の例文: 「20-40代の女性、在宅ワーカー、学生」
- P3-1（強み）の例文: 「自家焙煎のスペシャリティコーヒー、手作りスイーツ、落ち着いた空間」
- Q1-20（粗利率）のヘルプ: 「カフェの平均：約65%」

**美容室の場合:**

- Q1-1: 「美容室」と入力
- P2-1（ターゲット顧客）の例文: 「20-50代の女性、月1回以上の定期利用客」
- P3-1（強み）の例文: 「髪質改善トリートメントの専門技術、マンツーマン対応」
- Q1-20（粗利率）のヘルプ: 「美容業の平均：約75%」

---

## 3. 業種判定ロジック

`detectIndustry(businessType)`関数は、Q1-1の回答文字列から業種を判定します。

**判定キーワード:**

| 業種カテゴリ | キーワード |
|------------|-----------|
| restaurant | レストラン、イタリアン、フレンチ、中華、和食、居酒屋 |
| cafe | カフェ、喫茶 |
| beauty | 美容、エステ、ネイル、理容 |
| retail | 小売、販売、ショップ、雑貨、アパレル、書店 |
| lodging | 宿泊、ホテル、旅館、民泊、ゲストハウス |
| service | サービス、整体、教室、スクール |
| other | 上記に該当しない場合 |

**マッチングの仕組み:**
- 大文字小文字を区別しない（toLowerCase()で統一）
- 部分一致で判定（includes()メソッド使用）
- 複数のキーワードに対応（OR条件）

---

## 4. 業種別ベンチマークデータ

各業種について、以下の財務データを提供しています。

### レストラン
- 年間売上: 1,200〜2,400万円（平均1,800万円）
- 利益率: 8〜15%（平均10%）
- 粗利率: 60〜70%（平均65%）
- 客単価: 3,000〜8,000円（平均5,000円）

### カフェ
- 年間売上: 720〜1,200万円（平均960万円）
- 利益率: 8〜15%（平均12%）
- 粗利率: 60〜70%（平均65%）
- 客単価: 1,000〜2,000円（平均1,500円）

### 美容業
- 年間売上: 1,200〜3,600万円（平均1,800万円）
- 利益率: 10〜20%（平均15%）
- 粗利率: 70〜80%（平均75%）
- 客単価: 5,000〜15,000円（平均8,000円）

### 小売業
- 年間売上: 1,000〜5,000万円（平均2,000万円）
- 利益率: 3〜10%（平均5%）
- 粗利率: 25〜35%（平均30%）
- 客単価: 2,000〜10,000円（平均5,000円）

### 宿泊業
- 年間売上: 2,000〜10,000万円（平均5,000万円）
- 利益率: 5〜15%（平均10%）
- 粗利率: 40〜50%（平均45%）
- 客単価: 8,000〜30,000円（平均15,000円）

### サービス業
- 年間売上: 800〜2,400万円（平均1,500万円）
- 利益率: 10〜25%（平均18%）
- 粗利率: 60〜80%（平均70%）
- 客単価: 3,000〜10,000円（平均6,000円）

---

## 5. Phase 2（顧客分析）の業種別回答例

各業種について、以下の6つの質問に対する回答例を提供しています。

### 提供項目
1. **P2-1: ターゲット顧客** - 主な顧客層の特徴
2. **P2-2: 選ばれる理由** - 顧客が選ぶ理由
3. **P2-3: 顧客ニーズ** - 顧客が求めているもの
4. **P2-4: ニーズの変化** - 最近の市場変化
5. **P2-5: 市場トレンド** - 地域・業界の動向
6. **P2-6: 競合比較** - 競合と比べた顧客反応

### レストランの回答例
- ターゲット顧客: 「30-50代の女性グループ、デート利用のカップル」
- 選ばれる理由: 「本格的なイタリアンが楽しめる、雰囲気が良い」
- 顧客ニーズ: 「美味しい料理とゆったりした空間、特別な時間」
- ニーズの変化: 「コロナ後、テイクアウト需要が増えた。平日ランチの個人客も増加」
- 市場トレンド: 「駅前再開発で人通りが増加。インバウンド観光客も回復傾向」
- 競合比較: 「Google口コミ4.3以上を維持。リピーター率が高い」

（他の業種についても同様のデータを保持）

---

## 6. Phase 3（強み分析）の業種別回答例

各業種について、以下の7つの質問に対する回答例を提供しています。

### 提供項目
1. **P3-1: 独自性・差別化** - 他店にない特徴
2. **P3-2: 顧客への価値** - 提供している価値
3. **P3-3: 専門性・資格** - 人的資源
4. **P3-4: 設備・技術** - 物的資源
5. **P3-5: 実績・評価** - これまでの実績
6. **P3-6: 課題・弱み** - 改善したい点
7. **P3-7: 立地・商圏** - 立地の強み

### レストランの回答例
- 独自性: 「現地イタリアで修行したシェフの本格的な味、地元食材を活用した季節メニュー」
- 顧客価値: 「他では味わえない本場の味を提供、季節ごとの新しい発見がある」
- 専門性: 「調理師免許保有、イタリア・トスカーナ地方のレストランで3年修行、ソムリエ資格保有」
- 設備: 「石窯ピザ窯を導入、イタリア直輸入の食材を使用」
- 実績: 「Google口コミ4.3以上、地域のグルメ雑誌に掲載、リピーター率70%」
- 課題: 「認知度が低く新規客の獲得が課題、駐車場が限られている」
- 立地: 「駅から徒歩5分、住宅街にあり地域密着型、近隣に駐車場あり」

（他の業種についても同様のデータを保持）

---

## 7. UI側での処理（既存実装）

`ChatContainer.jsx`では、すでに動的なplaceholderとhelpTextを処理する仕組みが実装されています。

**処理箇所:**

```javascript
// 1029行目付近
helpText: typeof nextQuestion.helpText === 'function'
  ? nextQuestion.helpText(answers)
  : nextQuestion.helpText
```

この処理により、以下のように動作します:

1. 質問定義でplaceholderが関数形式の場合
2. `placeholder(answers)`を実行
3. `getDynamicPlaceholder(questionId, answers)`が呼ばれる
4. Q1-1の回答から業種を判定
5. 該当業種の例文を返す
6. UIに表示

helpTextについても同様の処理が行われます。

---

## 8. 今後の拡張ポイント

### 8.1 業種の追加
`industryExamples.js`に新しい業種を追加する場合:

1. `INDUSTRY_CATEGORIES`に新しいキーを追加
2. `detectIndustry()`関数にキーワード判定を追加
3. `INDUSTRY_BENCHMARKS`にベンチマークデータを追加
4. `PHASE2_EXAMPLES`と`PHASE3_EXAMPLES`に回答例を追加

### 8.2 Phase 4、Phase 5への適用
現在はPhase 2とPhase 3のみ実装していますが、同じ仕組みで他のPhaseにも適用可能です。

**実装手順:**
1. `industryExamples.js`に`PHASE4_EXAMPLES`などを追加
2. 各Phaseの質問定義ファイルで`getDynamicPlaceholder`を使用
3. 質問IDに応じた例文を返すように`getDynamicPlaceholder()`関数を拡張

### 8.3 業種判定の精度向上
現在は単純なキーワードマッチですが、以下の改善が可能です:

- Google Maps APIの`types`フィールドを活用
- 機械学習による業種分類
- ユーザーに業種を選択肢から選ばせる補助UI

### 8.4 回答例のバリエーション追加
現在は各質問に1つの例文ですが、複数のバリエーションを用意することも可能です。

例:
```javascript
targetCustomer: [
  '30-50代の女性グループ、デート利用のカップル',
  '地元の常連客、記念日利用のファミリー',
  'ビジネスランチ利用の会社員'
]
```

ランダムまたは他の回答内容に応じて選択する仕組みを実装できます。

---

## 9. テスト方法

### 手動テスト手順

1. アプリケーションを起動
   ```bash
   cd aidant-app
   npm start
   ```

2. 新規申請を開始

3. Q1-1で業種を入力
   - テストケース1: 「イタリアンレストラン」
   - テストケース2: 「カフェ」
   - テストケース3: 「美容室」
   - テストケース4: 「アパレルショップ」

4. Phase 2の質問に進む
   - P2-1のplaceholderが業種に応じた例文になっているか確認
   - helpTextも適切に表示されているか確認

5. Phase 3の質問に進む
   - P3-1のplaceholderが業種に応じた例文になっているか確認

6. Q1-20、Q1-21の質問
   - helpTextに業種別の平均値が表示されているか確認

### 期待される結果

**イタリアンレストランの場合:**
- P2-1 placeholder: 「例：30-50代の女性グループ、デート利用のカップル」
- Q1-20 helpText: 「レストランの平均：約65%」

**カフェの場合:**
- P2-1 placeholder: 「例：20-40代の女性、在宅ワーカー、学生」
- Q1-20 helpText: 「カフェの平均：約65%」

---

## 10. 実装の利点

### ユーザー体験の向上
1. **回答しやすくなる**: 業種に合った具体例が表示されるため、何を書けば良いか明確
2. **質の高い回答**: 適切な例文により、審査に通りやすい内容を自然に入力できる
3. **財務データの入力支援**: 業種平均値が表示されるため、概算値を入力しやすい

### 審査通過率の向上
1. **業種特有の強みを記載**: 審査員が期待する内容を自然に盛り込める
2. **具体性の向上**: 抽象的な回答ではなく、具体的な内容を記載しやすい
3. **一貫性の確保**: 業種に応じた一貫性のある申請書を作成できる

### メンテナンス性
1. **一元管理**: 業種別データを`industryExamples.js`で一元管理
2. **拡張性**: 新しい業種の追加が容易
3. **再利用性**: 同じデータを複数の質問で活用

---

## 11. 関連ドキュメント

- [業種別回答例と創作ガイドライン.md](./業種別回答例と創作ガイドライン.md) - 創作可能な項目と事実項目の区別
- [全質問リスト_模範解答付き.md](./全質問リスト_模範解答付き.md) - 全質問の模範回答例
- [CLAUDE.md](../CLAUDE.md) - プロジェクト全体の要件定義

---

## 12. 実装完了確認

- [x] `industryExamples.js`の作成
- [x] `conversationalQuestionsPhase2.js`への適用
- [x] `conversationalQuestionsPhase3.js`への適用
- [x] `conversationalQuestionsStep1.js`への適用（Q1-20、Q1-21）
- [x] 業種判定ロジックの実装
- [x] 業種別ベンチマークデータの整備
- [x] Phase 2回答例データベースの整備
- [x] Phase 3回答例データベースの整備
- [x] ドキュメント作成

**実装完了日:** 2025年10月23日

**次のステップ:** 実際のユーザーテストによる動作確認と、必要に応じた回答例の調整
