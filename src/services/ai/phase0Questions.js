// Phase 0: è£œåŠ©å¯¾è±¡åˆ¤å®š
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç„¡é§„ãªå…¥åŠ›ã‚’ã—ãªã„ã‚ˆã†ã€æœ€åˆã«è£œåŠ©äº‹æ¥­ã®è¦ä»¶ã‚’ç¢ºèª

export const PHASE0_QUESTIONS = [
  // Q0-1: å–çµ„ã®ç›®çš„
  {
    id: 'Q0-1',
    priority: 0.1,
    text: 'ã“ã®è£œåŠ©é‡‘ã§å®Ÿæ–½ã™ã‚‹å–çµ„ã®ç›®çš„ã¯ä½•ã§ã™ã‹ï¼Ÿï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰',
    type: 'multi_select',
    options: [
      { value: 'æ–°è¦é¡§å®¢ã®ç²å¾—', label: 'æ–°è¦é¡§å®¢ã®ç²å¾—' },
      { value: 'æ—¢å­˜é¡§å®¢ã¸ã®ãƒªãƒ”ãƒ¼ãƒˆä¿ƒé€²', label: 'æ—¢å­˜é¡§å®¢ã¸ã®ãƒªãƒ”ãƒ¼ãƒˆä¿ƒé€²' },
      { value: 'èªçŸ¥åº¦ã®å‘ä¸Š', label: 'èªçŸ¥åº¦ã®å‘ä¸Š' },
      { value: 'è²©å£²ä¿ƒé€²ãƒ»PRã®å¼·åŒ–', label: 'è²©å£²ä¿ƒé€²ãƒ»PRã®å¼·åŒ–' },
      { value: 'æ¥­å‹™åŠ¹ç‡åŒ–ãƒ»ç”Ÿç”£æ€§å‘ä¸Š', label: 'æ¥­å‹™åŠ¹ç‡åŒ–ãƒ»ç”Ÿç”£æ€§å‘ä¸Š' },
      { value: 'å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã®æ”¹å–„', label: 'å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã®æ”¹å–„' }
    ],
    required: true,
    dependencies: [],
    aiEnhance: false,
    helpText: 'ğŸ’¡ å°è¦æ¨¡äº‹æ¥­è€…æŒç¶šåŒ–è£œåŠ©é‡‘ã¯ã€Œè²©è·¯é–‹æ‹“ã€ã¾ãŸã¯ã€Œç”Ÿç”£æ€§å‘ä¸Šã€ã‚’ç›®çš„ã¨ã—ãŸå–çµ„ãŒå¯¾è±¡ã§ã™ã€‚\n\nå…¨ã¦è©²å½“ã™ã‚‹å ´åˆã¯å…¨ã¦é¸æŠã—ã¦ãã ã•ã„ã€‚'
  },

  // Q0-2: è³¼å…¥ãƒ»å®Ÿæ–½äºˆå®šã®ã‚‚ã®ï¼ˆè‡ªç”±å…¥åŠ›å½¢å¼ï¼‰
  {
    id: 'Q0-2',
    priority: 0.2,
    text: 'ã“ã®è£œåŠ©é‡‘ã§ä½•ã‚’è³¼å…¥ãƒ»å®Ÿæ–½ã™ã‚‹äºˆå®šã§ã™ã‹ï¼Ÿ',
    type: 'textarea',
    placeholder: 'ä¾‹ï¼š\nãƒ»ãƒãƒ©ã‚·ã‚’5000éƒ¨ä½œæˆã—ã¦ã€é§…å‰ã§é…å¸ƒã™ã‚‹\nãƒ»åº—èˆ—ã®çœ‹æ¿ã‚’æ–°ã—ãã™ã‚‹\nãƒ»æ¥­å‹™ç”¨å†·è”µåº«ã‚’1å°è³¼å…¥ã™ã‚‹\nãƒ»ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ‹ãƒ¥ãƒ¼ã‚¢ãƒ«ã™ã‚‹',
    required: true,
    dependencies: ['Q0-1'],
    aiEnhance: false,
    helpText: 'ğŸ’¡ æ€ã„ã¤ã„ãŸã‚‚ã®ã‚’è‡ªç”±ã«æ›¸ã„ã¦ãã ã•ã„ã€‚AIãŒè£œåŠ©å¯¾è±¡ã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ã¾ã™ã€‚\n\nã€å¯¾è±¡ã¨ãªã‚‹ä¾‹ã€‘\nãƒ»åºƒå ±è²»ï¼šãƒãƒ©ã‚·ã€çœ‹æ¿ã€åºƒå‘Šæ²è¼‰\nãƒ»ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆé–¢é€£è²»ï¼šHPä½œæˆã€SNSåºƒå‘Šï¼ˆå…¨ä½“ã®1/4ä»¥å†…ï¼‰\nãƒ»æ©Ÿæ¢°è£…ç½®ç­‰è²»ï¼šæ¥­å‹™ç”¨æ©Ÿæ¢°ã€è¨­å‚™\nãƒ»å±•ç¤ºä¼šç­‰å‡ºå±•è²»ï¼šå‡ºå±•æ–™ã€ãƒ–ãƒ¼ã‚¹è£…é£¾\n\nã€å¯¾è±¡å¤–ã®ä¾‹ã€‘\nãƒ»å»ºç‰©ã®å»ºç¯‰ãƒ»è³¼å…¥\nãƒ»è»Šä¸¡è³¼å…¥ï¼ˆè»½ãƒˆãƒ©ãƒƒã‚¯ç­‰ã‚‚ä¸å¯ï¼‰\nãƒ»äººä»¶è²»ãƒ»å®¶è³ƒãƒ»å…‰ç†±è²»',
    validation: null  // AIåˆ¤å®šã«ç§»è¡Œã™ã‚‹ãŸã‚ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´validationã¯å‰Šé™¤
  },

  // Q0-3: éå»ã®å—çµ¦æ­´
  {
    id: 'Q0-3',
    priority: 0.3,
    text: 'éå»ã«å°è¦æ¨¡äº‹æ¥­è€…æŒç¶šåŒ–è£œåŠ©é‡‘ã‚’å—ã‘ãŸã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ',
    type: 'single_select',
    options: [
      { value: 'ã„ã„ãˆ', label: 'ã„ã„ãˆï¼ˆåˆã‚ã¦ç”³è«‹ã—ã¾ã™ï¼‰' },
      { value: 'ã¯ã„', label: 'ã¯ã„ï¼ˆéå»ã«å—ã‘ãŸã“ã¨ãŒã‚ã‚‹ï¼‰' }
    ],
    required: true,
    dependencies: ['Q0-2'],
    aiEnhance: false,
    helpText: 'ğŸ’¡ éå»ã«å—ã‘ãŸå ´åˆã§ã‚‚ã€ä¸€å®šæœŸé–“çµŒéå¾Œã¯å†ç”³è«‹å¯èƒ½ã§ã™ã€‚\n\nãŸã ã—ã€ä»¥ä¸‹ã®åˆ¶é™ãŒã‚ã‚Šã¾ã™ï¼š\n- åŒä¸€ã®è£œåŠ©äº‹æ¥­ã§ã®é‡è¤‡ç”³è«‹ã¯ä¸å¯\n- å‰å›ã®è£œåŠ©äº‹æ¥­å®Œäº†ã‹ã‚‰ä¸€å®šæœŸé–“ã®çµŒéãŒå¿…è¦'
  },

  // Q0-4: å‰å›ã®å—çµ¦æ™‚æœŸï¼ˆæ¡ä»¶ä»˜ãï¼‰
  {
    id: 'Q0-4',
    priority: 0.4,
    text: 'å‰å›ã®è£œåŠ©é‡‘ã¯ã„ã¤å—çµ¦ã—ã¾ã—ãŸã‹ï¼Ÿï¼ˆè£œåŠ©äº‹æ¥­ã®å®Œäº†æ™‚æœŸï¼‰',
    type: 'date',
    placeholder: '2024-03',
    required: true,
    dependencies: ['Q0-3'],
    condition: (answers) => {
      return answers['Q0-3'] === 'ã¯ã„';
    },
    aiEnhance: false,
    helpText: 'ğŸ’¡ è£œåŠ©äº‹æ¥­ã®å®Ÿç¸¾å ±å‘Šæ›¸ã‚’æå‡ºã—ãŸæ™‚æœŸï¼ˆè£œåŠ©äº‹æ¥­å®Œäº†æ™‚æœŸï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
    validation: (value, answers) => {
      if (!value) {
        return {
          isValid: false,
          message: 'å‰å›ã®è£œåŠ©äº‹æ¥­å®Œäº†æ™‚æœŸã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'
        };
      }

      const completionDate = new Date(value);
      const today = new Date();
      const monthsDiff = (today - completionDate) / (1000 * 60 * 60 * 24 * 30);

      // å‰å›ã‹ã‚‰6ãƒ¶æœˆä»¥ä¸ŠçµŒéã—ã¦ã„ã‚‹ã‹ç¢ºèª
      // â€»å®Ÿéš›ã®è¦ä»¶ã¯å…¬å‹Ÿè¦é ˜ã«å¾“ã£ã¦èª¿æ•´ã—ã¦ãã ã•ã„
      if (monthsDiff < 6) {
        return {
          isValid: false,
          message: 'âš ï¸ å‰å›ã®è£œåŠ©äº‹æ¥­å®Œäº†ã‹ã‚‰6ãƒ¶æœˆä»¥ä¸ŠçµŒéã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n\nå†ç”³è«‹å¯èƒ½ã«ãªã‚‹ã¾ã§ãŠå¾…ã¡ãã ã•ã„ã€‚'
        };
      }

      return { isValid: true };
    }
  }
];

// Phase 0ãŒå®Œäº†ã—ãŸã‹ãƒã‚§ãƒƒã‚¯
export const isPhase0Complete = (answers) => {
  // Q0-1, Q0-2, Q0-3ã¯å¿…é ˆ
  if (!answers['Q0-1'] || !answers['Q0-2'] || !answers['Q0-3']) {
    return false;
  }

  // Q0-3ã§ã€Œã¯ã„ã€ã‚’é¸æŠã—ãŸå ´åˆã¯ã€Q0-4ã‚‚å¿…é ˆ
  if (answers['Q0-3'] === 'ã¯ã„' && !answers['Q0-4']) {
    return false;
  }

  return true;
};

// Phase 0ã®æœ€åˆã®è³ªå•ã‚’å–å¾—
export const getFirstPhase0Question = () => {
  return PHASE0_QUESTIONS[0];
};

// Phase 0ã®æ¬¡ã®è³ªå•ã‚’å–å¾—
export const getNextPhase0Question = (answers) => {
  for (const question of PHASE0_QUESTIONS) {
    // æ—¢ã«å›ç­”æ¸ˆã¿
    if (answers[question.id]) continue;

    // ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯
    const dependenciesMet = question.dependencies.every(dep => answers[dep]);
    if (!dependenciesMet) continue;

    // æ¡ä»¶ãƒã‚§ãƒƒã‚¯
    if (question.condition && !question.condition(answers)) continue;

    return question;
  }

  return null;
};
